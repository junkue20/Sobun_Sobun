<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>새로운 1인가구 공구문화 - 소분소분</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <!-- font-awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- <link rel="stylesheet" th:href="@{/css/km/noneed_order/elegant-icons.css}" type="text/css">
     <link rel="stylesheet" th:href="@{/css/km/noneed_order/magnific-popup.css}" type="text/css">
     <link rel="stylesheet" th:href="@{/css/km/noneed_order/jquery-ui.min.css}" type="text/css">
     <link rel="stylesheet" th:href="@{/css/km/noneed_order/owl.carousel.min.css}" type="text/css">
     <link rel="stylesheet" th:href="@{/css/km/noneed_order/slicknav.min.css}" type="text/css"> -->

    <link rel="stylesheet" th:href="@{/css/km/noneed_order/checkoutstyle.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/km/noneed_order/checkouttable.css}" type="text/css">

    <th:block th:replace="~{/se/customer/header :: headerCSS}"></th:block>
    <th:block th:replace="~{/km/customer/footer :: footerCSS}"></th:block>

    <script th:src="@{/js/bootstrap.min.js}"></script>
    <!-- axios (https://cdnjs.com/libraries/axios) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.5/axios.min.js"
        integrity="sha512-nnNHpffPSgINrsR8ZAIgFUIMexORL5tPwsfktOTxVYSv+AUAILuFYWES8IHl+hhIhpFGlKvWFiz9ZEusrPcSBQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- 토스페이 cdn -->
    <script src="https://js.tosspayments.com/v1/payment-widget"></script>
</head>
<!-- 주문 페이지-->

<body>
    <!-- header -->
    <th:block th:replace="~{/se/customer/header :: headerHTML}"></th:block>

    <!-- 본문 영역 (padding-bottom은 건들면 안돼요ㅠㅠ footer랑 겹치는 문제 해결용임돵) -->
    <div class="checkout spad" style="padding-bottom: 350px;">

        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h6 class="coupon__link">
                        <!-- <i class="fa fa-tag"></i> <a th:href="@{/customer/item/selectone.do(no=${})}" style="text-decoration: none;">이전페이지 돌아가기</a> -->
                    </h6>
                </div>
            </div>
            <form action="#" class="checkout__form">
                <div class="row" style="margin-right: 0;margin-left: 0;">

                    <!-- 주문 정보 ~ -->
                    <div class="col-lg-8 mb-4">
                        <h5>주문정보</h5>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="checkout__form__input">
                                    <p>주문하시는 분 <span>*</span></p>
                                    <input type="text">
                                </div>

                                <div class="checkout__form__input">
                                    <p>휴대전화 <span>*</span></p>
                                    <input type="text" placeholder="- 빼고 입력해주세요">
                                </div>
                                <div class="checkout__form__input">
                                    <p>이메일 <span>*</span></p>
                                    <input type="text" placeholder="Street Address">
                                </div>
                                <div class="checkout__form__input">
                                    <p>참여인원 <span>*</span></p>
                                    <input type="text" th:value="|${obj.participant}명|" readonly>
                                </div>
                                <div class="checkout__form__input">
                                    <p>수령지점 <span>*</span></p>
                                    <input type="text" th:value="${obj.storageName}" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ~ 주문 정보 -->

                    <!-- 최종 결제 금액 ~ -->
                    <div class="col-lg-4" style="margin-top: 60px;">
                        <div class="checkout__order">
                            <h5>최종 결제 금액</h5>
                            <div class="checkout__order__product">
                                <ul>
                                    <li>
                                        <span class="top__text">카드 결제</span>
                                        <!-- <span class="top__text__right">Total</span> -->
                                    </li>
                                    <li>상품 금액 <span th:text="${#numbers.formatInteger(obj.pricePerOne, 3, 'COMMA') + '원'}"></span></li>
                                    <li>배송비<span th:text="${#numbers.formatInteger(2000 / obj.participant, 3, 'COMMA') + '원'}"></span></li>
                                </ul>
                            </div>
                            <div class="checkout__order__total">
                                <ul>
                                    <!-- <li>Subtotal <span>$ 750.0</span></li> -->
                                    <li>Total <span id="total_price" th:text="${#numbers.formatInteger(obj.pricePerOne + 2000 / obj.participant, 3, 'COMMA') + '원'}"></span></li>
                                </ul>
                            </div>
                            <button type="button" onclick="requestPay()" class="site-btn">결제하기</button>
                        </div>
                    </div>
                    <!-- ~ 최종 결제 금액 -->

                    <!-- 결제 수단 ~ -->
                    <!-- <div class="col-lg-8 table_container mb-4 mt3">
                        <h5>결제수단</h5>
                        <div class="row">
                            <div class="col-lg-12">
                                
                            </div>
                        </div>
                    </div> -->
                    <!-- ~ 결제 수단 -->

                    <!-- 상품 정보 ~ -->
                    <div class="col-lg-8 mt-3 table_container">
                        <h5 style="margin-bottom: 0;">상품정보</h5>
                        <div class="row" style="margin-top: -20px;">
                            <div class="col-lg-12">
                                <!-- 테이블 시작 ~ -->
                                <div class="container">
                                    <div class="row row--top-20">
                                        <div class="col-md-12">
                                            <div class="table-container">
                                                <table class="table">
                                                    <thead class="table__thead">
                                                        <tr>
                                                            <th class="table__th">상품정보</th>
                                                            <th class="table__th">총판매가</th>
                                                            <th class="table__th">1인당 판매가</th>
                                                            <th class="table__th">배송비</th>
                                                            <th class="table__th">합계</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="table__tbody">
                                                        <tr class="table-row table-row--item">
                                                            <td class="table-row__td">
                                                                <div class="table-row__img">
                                                                    <img th:src="${obj.imageUrl}" alt="">
                                                                </div>
                                                                <div class="table-row__info">
                                                                    <p class="table-row__name"
                                                                        th:text="${obj.itemName}"></p>
                                                                </div>
                                                            </td>
                                                            <td data-column="Policy" class="table-row__td">
                                                                <div class="">
                                                                    <p class="table-row__policy"
                                                                        th:text="${#numbers.formatInteger(obj.itemPrice, 3, 'COMMA') + '원'}">
                                                                    </p>
                                                                </div>
                                                            </td>
                                                            <td data-column="Policy" class="table-row__td">
                                                                <p class="table-row__policy"
                                                                    th:text="${#numbers.formatInteger(obj.pricePerOne, 3, 'COMMA') + '원'}">
                                                                </p>
                                                            </td>
                                                            <td data-column="Destination" class="table-row__td" th:text="|2,000원 / ${obj.participant}명|">
                                                                
                                                            </td>
                                                            <td data-column="Policy" class="table-row__td">
                                                                <p class="table-row__policy">합계</p>
                                                            </td>

                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <!-- ~ 테이블 시작 -->
                            </div>

                        </div>
                    </div>
                    <!-- ~ 상품 정보 -->

                </div>
            </form>
        </div>
    </div>

    <!-- footer -->
    <th:block th:replace="~{/km/customer/footer :: footerHTML}"></th:block>




    <!-- 
        <script th:src="@{/js/km/noneed_order/jquery.magnific-popup.min.js}"></script> 
        <script th:src="@{/js/km/noneed_order/jquery-ui.min.js}"></script> 
        <script th:src="@{/js/km/noneed_order/mixitup.min.js}"></script> 
        <script th:src="@{/js/km/noneed_order/jquery.countdown.min.js}"></script> 
        <script th:src="@{/js/km/noneed_order/jquery.slicknav.js}"></script> 
        <script th:src="@{/js/km/noneed_order/owl.carousel.min.js}"></script> 
        <script th:src="@{/js/km/noneed_order/jquery.nicescroll.min.js}"></script> 
        <script th:src="@{/js/km/noneed_order/main.js}"></script> 
    -->

    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <!-- 아임포트 라이브러리 -->
    <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>

    <script th:inline="javascript" type="text/javascript">
        const IMP = window.IMP; // 생략 가능
        IMP.init("imp07130721"); // 예: imp00000000a

        var today = new Date();   
        var hours = today.getHours(); // 시
        var minutes = today.getMinutes();  // 분
        var seconds = today.getSeconds();  // 초
        var milliseconds = today.getMilliseconds();
        var makeMerchantUid = hours +  minutes + seconds + milliseconds;

        totalPrice = Math.floor(parseInt(/*[[${obj.pricePerOne}]]*/"") + parseFloat(2000 / /*[[${obj.participant}]]*/""));
        console.log(totalPrice)

        function requestPay() {
            IMP.request_pay({
                // pg: "html5_inicis",
                pay_method: "card",
                merchant_uid: "IMP" + makeMerchantUid, // 주문번호 (고유해야함)나중에 IMP 자리에 고객 아이디 집어넣기
                name: /*[[${obj.itemName}]]*/"",
                // amount: totalPrice,                         // 숫자 타입
                amount: 100,    
                buyer_email: "ming9396@naver.com", // 세션에 저장된 아이디로 컨트롤러에서 customer 가져오기
                buyer_name: "이경민", 
                buyer_tel: "010-4665-4069",
                buyer_addr: "부산시 남구 신선로 365",
                buyer_postcode: "48905"
            }, function (rsp) { // callback
                //rsp.imp_uid 값으로 결제 단건조회 API를 호출하여 결제결과를 판단합니다.
                if(rsp.success) {
                    console.log(rsp);
                    // 담기는 값 확인
                    // apply_num : "00442238"
                    // bank_name :  null
                    // buyer_addr : "부산시 남구 신선로 365"
                    // buyer_email : "ming9396@naver.com"
                    // buyer_name : "이경민"
                    // buyer_postcode : "48905"
                    // buyer_tel : "010-4665-4069"
                    // card_name : "현대카드"
                    // card_number : "489016*********2"
                    // card_quota : 0
                    // currency : "KRW"
                    // custom_data : null
                    // imp_uid : "imp_667092871400"
                    // merchant_uid : "IMP194"
                    // name : "액체형 세제 2.8L 6개"
                    // paid_amount : 100
                    // paid_at : 1684826114
                    // pay_method : "card"
                    // pg_provider : "html5_inicis"
                    // pg_tid : "StdpayCARDINIpayTest20230523161514230573"
                    // pg_type : "payment"
                    // receipt_url : "https://iniweb.inicis.com/DefaultWebApp/mall/cr/cm/mCmReceipt_head.jsp?noTid=StdpayCARDINIpayTest20230523161514230573&noMethod=1"
                    // status : "paid"


                    console.log("여기서 이제 replace 해줘..?");
                    location.replace(/*[[@{/customer/home.do}]]*/"");
                } else {
                    console.log(rsp);
                }
            });
        }
    </script>
</body>

</html>