<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.km.KmCustomerMapper">

    <!-- 상품에 대한 열린 공구 가져오기 -> 남은 인원 -->
    <select id="countRemainingPerson" parameterType="long" resultType="int">
        SELECT  participant-count(*) 
        FROM (SELECT *, ROW_NUMBER() OVER (PARTITION BY memid ORDER BY no desc) recent 
 		FROM purchaseview p WHERE purchaseno = #{purchaseno} ) 
        WHERE recent=1 AND state=0 AND cancel=0
    </select>

</mapper>